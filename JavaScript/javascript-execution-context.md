# 실행 컨텍스트(Execution Context)

**코드가 실행되려면 스코프를 구분하여 식별자와 바인딩된 값을 관리할 수 있어야 한다.**  
실행 가능한 코드를 평가하고 실행하기 위해 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역

1. 선언에 의해 생성된 모든 식별자의 스코프를 구분하여 등록, 상태 변화를 지속적으로 관리
2. 스코프 체인을 통해 상위 스코프로 이동하며 식별자를 검색(스코프는 중첩 관계에 의해 스코프 체인을 형성)
3. 현재 실행 중인 코드의 실행 순서를 변경, 다시 되돌아갈 수도 있다.



### 전역 코드 평가

변수 선언문과 함수 선언문이 평가되고, 전역 변수와 전역 함수는 전역 스코프에 등록된다. var 키워드로 선언된 전역 변수와 함수 선언문으로 정의된 전역 함수는 전역 객체의 프로퍼티가 된다.



### 전역 코드 실행
전역 코드 평가가 종료되면 순차적으로 전역 코드가 실행, 전역 변수에 값이 할당되고 함수가 호출된다. 함수가 호출되면 순차적으로 실행되던 전역 코드의 실행을 일시 중단하고 코드 실행 순서를 변경하여 함수 내부로 진입한다.



### 함수 코드 평가

매개 변수와 지역 변수 선언문 평가 후 지역 스코프에 등록, 이때 함수 내부에서 지역 변수처럼 사용할 수 있는 arguments 객체도 생성되어 지역 스코프에 등록 된다.



> **전역코드 평가**  
> ↳ 전역 변수 선언문, 함수 선언문 평가   
> 	⇣  
> 	전역 스코프에 등록  
> 	⇣  
> 전역 코드 평가 종료  
> **전역 코드 실행**  
> ↳전역 변수에 값 할당, 함수 호출  
> 	(함수가 호출되면 전역 코드 실행 일시 중단)  
> 	⇣  
> 	(호출된 함수 내부 진입  
> 		↳**함수 코드 평가**  
> 			↳매개 변수, 지역 변수 선언문 평가, 함수 내부 arguments 객체 생성  
> 				⇣  
> 				지역 스코프 등록  
> 				⇣  
> 			함수 코드 평가 종료  
> 			**함수 코드 실행** 
> 			↳매개 변수, 지역 변수 값 할당  
> 				↳(지역 스코프에 없는 식별자  
> 					⇣  
> 					스코프 체인을 통해 검색)  
> 					⇣  
> 			함수 코드 실행 종료  
> 	함수 호출 이전 전역 코드 실행)  
> 	⇣   
> 전역 코드 실행 종료



**식별자를 등록하고 스코프와 실행 순서 관리를 구현한 내부 매커니즘, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.**

자바스크립트 엔진은 **코드를 평가하여 실행 컨텍스트를 생성**한다.

실행 컨텍스트는 stack 자료 구조로 관리된다.  
이를 **실행 컨텍스트 스택(Execution context stack)** 혹은 **콜 스택(Call stack)**이라한다.

실행 컨텍스트는 **LexicalEnviroment 컴포넌트**, **VariableEnviroment 컴포넌트**로 구성 된다.

실행 컨텍스트가 생성되면 VariableEnvironment 컴포넌트와  LexicalEnvironment 컴포넌트는 **동일한 렉시컬 환경(Lexical Enviroment)을 참조**한다.
(코드가 실행되다가 특수한 상황을 만나면 VariableEnvironment 컴포넌트를 위한 새로운 렉시컬 환경을 생성하여 생성하고 이때부터 VariableEnvironment 컴포넌트와 LexicalEnvironment 컴포넌트는 내용이 달라지게 되며 이후 주로 LexicalEnvironment 컴포넌트를 사용한다.)



## 렉시컬 환경의 3가지 컴포넌트

### 환경 레코드(Environment Record)

스코프에 포함된 식별자를 등록하고 등록된 식별자에 바인딩된 값을 관리하는 저장소, 환경 레코드는 실행 가능한 코드의 종류에 따라 내용에 차이가 있다.

### 외부 렉시컬 환경에 대한 참조(Outer Lexical Environment Reference)

외부 렉시컬 환경을 가리키는 참조를 저장한다. **외부 렉시컬 환경이란 해당 실행 컨텍스트를 생성한 실행 가능한 코드를 포함하는 상위 코드의 렉시컬 환경을 말한다.** 이를 통해 (단방향 링크드 리스트인 )스코프 체인을 구현한다.

### this 바인딩(This binding)

렉시컬 환경의 this에 바인딩된 객체(ThisBinding)를 나타낸다. 
this 바인딩은 추상 연산 [ResolveThisBinding](https://tc39.github.io/ecma262/#sec-resolvethisbinding)을 통해 결정할 수 있다.

#### 전역 코드 평가 순서

1. 전역 실행 컨텍스트 생성

2. 전역 렉시컬 환경 생성

  2.1. 전역 환경 레코드 생성
  	2.1.1. 객체 환경 레코드 생성
  	2.1.2. 선언적 환경 레코드 생성
  2.2. 외부 렉시컬 환경에 대한 참조 할당
  2.3. this 바인딩

전역 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 생성된 실행 컨텍스트를 푸시하면 해당 실행 컨텍스트는 실행 중인 실행 컨텍스트가 된다.



---



## 퀴즈

Q1. 실행 컨텍스트는 `(a)` 자료 구조로 관리 된다. `(b)` 혹은 `(c)`   이라 한다.

- A.  
  (a) 스택(Stack)  
  (b) 실행 컨텍스트 스택(Execution context stack)  
  (c) 콜 스택(Call stack)

Q2. 실행 컨텍스트 관점에서 스코프 체인의 동작을 설명

- A.

  running execution context의 Lexical Enviroment에서 식별자를 검색할 수 없으면 OuterLexicalEnvironment가 가리키는 상위 Lexical Enviroment으로 이동하여 식별자를 검색한다.

Q3. 각각 어떠한 요소를 찾을때 프로토타입 체인과 스코프 체인의 차이

- A.  
  프로토타입 체인은 객체가 가지고있는 프로퍼티를 찾을때 사용되고, 스코프 체인은 식별자를 찾을때 사용된다.

Q4. 전역 실행 컨텍스트를 생성하고 실행 컨텍스트 스택에 생성된 실행 컨텍스트를 푸시하면 해당 실행 컨텍스트는 실행 중인 실행 컨텍스트가 된다. ( O / X )

- A.  
  O, 실행 컨텍스트 스택에 푸시된 실행 컨텍스트는 최상위에 올라가면서 running execution context가 된다.

Q5. 실행 컨텍스트 관점에서 var 키워드로 선언된 변수와 let, const로 선언된 변수의 차이

- A.